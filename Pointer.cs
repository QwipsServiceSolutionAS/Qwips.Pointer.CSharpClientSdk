// <auto-generated/>
using Microsoft.Kiota.Abstractions.Extensions;
using Microsoft.Kiota.Abstractions;
using Microsoft.Kiota.Serialization.Form;
using Microsoft.Kiota.Serialization.Json;
using Microsoft.Kiota.Serialization.Multipart;
using Microsoft.Kiota.Serialization.Text;
using Qwips.Core.Pointer.SkmXrm;
using Qwips.Core.Pointer.XrmAutomation;
using Qwips.Core.Pointer.XrmAzureAdmin;
using Qwips.Core.Pointer.XrmDb;
using Qwips.Core.Pointer.XrmDbExport;
using Qwips.Core.Pointer.XrmDrive;
using Qwips.Core.Pointer.XrmEmail;
using Qwips.Core.Pointer.XrmPdfgen;
using Qwips.Core.Pointer.XrmSmsc;
using Qwips.Core.Pointer.XrmTenants;
using Qwips.Core.Pointer.XrmUsers;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Threading.Tasks;
using System;
using Microsoft.Kiota.Abstractions.Serialization;
using System.Xml;
using System.Diagnostics;
using System.Text.Json.Nodes;
using System.Text.Json;

namespace Qwips.Core.Pointer
{
    /// <summary>
    /// The main entry point of the SDK, exposes the configuration and the fluent API.
    /// </summary>
    public class Pointer : BaseRequestBuilder
    {
        /// <summary>The skmXrm property</summary>
        public SkmXrmRequestBuilder SkmXrm
        {
            get =>
            new SkmXrmRequestBuilder(PathParameters, RequestAdapter);
        }
        /// <summary>The xrmAutomation property</summary>
        public XrmAutomationRequestBuilder XrmAutomation
        {
            get =>
            new XrmAutomationRequestBuilder(PathParameters, RequestAdapter);
        }
        /// <summary>The xrmAzureAdmin property</summary>
        public XrmAzureAdminRequestBuilder XrmAzureAdmin
        {
            get =>
            new XrmAzureAdminRequestBuilder(PathParameters, RequestAdapter);
        }
        /// <summary>The xrmDb property</summary>
        public XrmDbRequestBuilder XrmDb
        {
            get =>
            new XrmDbRequestBuilder(PathParameters, RequestAdapter);
        }
        /// <summary>The xrmDbExport property</summary>
        public XrmDbExportRequestBuilder XrmDbExport
        {
            get =>
            new XrmDbExportRequestBuilder(PathParameters, RequestAdapter);
        }
        /// <summary>The xrmDrive property</summary>
        public XrmDriveRequestBuilder XrmDrive
        {
            get =>
            new XrmDriveRequestBuilder(PathParameters, RequestAdapter);
        }
        /// <summary>The xrmEmail property</summary>
        public XrmEmailRequestBuilder XrmEmail
        {
            get =>
            new XrmEmailRequestBuilder(PathParameters, RequestAdapter);
        }
        /// <summary>The xrmPdfgen property</summary>
        public XrmPdfgenRequestBuilder XrmPdfgen
        {
            get =>
            new XrmPdfgenRequestBuilder(PathParameters, RequestAdapter);
        }
        /// <summary>The xrmSmsc property</summary>
        public XrmSmscRequestBuilder XrmSmsc
        {
            get =>
            new XrmSmscRequestBuilder(PathParameters, RequestAdapter);
        }
        /// <summary>The xrmTenants property</summary>
        public XrmTenantsRequestBuilder XrmTenants
        {
            get =>
            new XrmTenantsRequestBuilder(PathParameters, RequestAdapter);
        }
        /// <summary>The xrmUsers property</summary>
        public XrmUsersRequestBuilder XrmUsers
        {
            get =>
            new XrmUsersRequestBuilder(PathParameters, RequestAdapter);
        }
        /// <summary>
        /// Instantiates a new Pointer and sets the default values.
        /// </summary>
        /// <param name="requestAdapter">The request adapter to use to execute the requests.</param>
        public Pointer(IRequestAdapter requestAdapter) : base(requestAdapter, "{+baseurl}", new Dictionary<string, object>())
        {
            ApiClientBuilder.RegisterDefaultSerializer<JsonSerializationWriterFactory>();
            ApiClientBuilder.RegisterDefaultSerializer<TextSerializationWriterFactory>();
            ApiClientBuilder.RegisterDefaultSerializer<FormSerializationWriterFactory>();
            ApiClientBuilder.RegisterDefaultSerializer<MultipartSerializationWriterFactory>();
            ApiClientBuilder.RegisterDefaultDeserializer<JsonParseNodeFactory>();
            ApiClientBuilder.RegisterDefaultDeserializer<HtmlParseNodeFactory>();
            ApiClientBuilder.RegisterDefaultDeserializer<TextParseNodeFactory>();
            ApiClientBuilder.RegisterDefaultDeserializer<FormParseNodeFactory>();
            if (string.IsNullOrEmpty(RequestAdapter.BaseUrl))
            {
                RequestAdapter.BaseUrl = "/api";
            }
            PathParameters.TryAdd("baseurl", RequestAdapter.BaseUrl);
        }
    }

    /// <summary>
    /// The <see cref="IParseNodeFactory"/> implementation for text/plain content types
    /// </summary>
    public class HtmlParseNodeFactory : IParseNodeFactory
    {
        /// <inheritdoc />
        public string ValidContentType => "text/html";
        /// <inheritdoc />
        public IParseNode GetRootParseNode(string contentType, Stream content)
        {
            if (string.IsNullOrEmpty(contentType))
                throw new ArgumentNullException(nameof(contentType));
            else if (!ValidContentType.Equals(contentType, StringComparison.OrdinalIgnoreCase))
                throw new ArgumentOutOfRangeException($"expected a {ValidContentType} content type");

            _ = content ?? throw new ArgumentNullException(nameof(content));
            using var reader = new StreamReader(content);
            var stringContent = reader.ReadToEnd();
            return new HtmlParseNode(stringContent);
        }
    }
    public class HtmlParseNode : IParseNode
    {
        internal const string NoStructuredDataMessage = "text does not support structured data";
        private readonly string? Text;
        /// <summary>
        /// Initializes a new instance of the <see cref="TextParseNode"/> class.
        /// </summary>
        /// <param name="text">The text value.</param>
        public HtmlParseNode(string? text)
        {
            Text = text?.Trim('"');
        }
        /// <inheritdoc />
        public Action<IParsable>? OnBeforeAssignFieldValues { get; set; }
        /// <inheritdoc />
        public Action<IParsable>? OnAfterAssignFieldValues { get; set; }
        /// <inheritdoc />
        public bool? GetBoolValue() => bool.TryParse(Text, out var result) ? result : null;
        /// <inheritdoc />
        public byte[]? GetByteArrayValue() => string.IsNullOrEmpty(Text) ? null : Convert.FromBase64String(Text);
        /// <inheritdoc />
        public byte? GetByteValue() => byte.TryParse(Text, out var result) ? result : null;
        /// <inheritdoc />
        public IParseNode GetChildNode(string identifier) => throw new InvalidOperationException(NoStructuredDataMessage);
        /// <inheritdoc />
        public IEnumerable<T> GetCollectionOfObjectValues<T>(ParsableFactory<T> factory) where T : IParsable => throw new InvalidOperationException(NoStructuredDataMessage);
        /// <inheritdoc />
        public IEnumerable<T> GetCollectionOfPrimitiveValues<T>() => throw new InvalidOperationException(NoStructuredDataMessage);
        /// <inheritdoc />
        public DateTimeOffset? GetDateTimeOffsetValue() => DateTimeOffset.TryParse(Text, out var result) ? result : null;
        /// <inheritdoc />
        public Date? GetDateValue() => DateTime.TryParse(Text, out var result) ? new Date(result) : null;
        /// <inheritdoc />
        public decimal? GetDecimalValue() => decimal.TryParse(Text, out var result) ? result : null;
        /// <inheritdoc />
        public double? GetDoubleValue() => double.TryParse(Text, out var result) ? result : null;
        /// <inheritdoc />
        public float? GetFloatValue() => float.TryParse(Text, out var result) ? result : null;
        /// <inheritdoc />
        public Guid? GetGuidValue() => Guid.TryParse(Text, out var result) ? result : null;
        /// <inheritdoc />
        public int? GetIntValue() => int.TryParse(Text, out var result) ? result : null;
        /// <inheritdoc />
        public long? GetLongValue() => long.TryParse(Text, out var result) ? result : null;
        /// <inheritdoc />
        public T GetObjectValue<T>(ParsableFactory<T> factory) where T : IParsable
        {
            var item = factory(this);
            OnBeforeAssignFieldValues?.Invoke(item);
            AssignFieldValues(item);
            OnAfterAssignFieldValues?.Invoke(item);
            return item;
        }

        private void AssignFieldValues<T>(T item) where T : IParsable
        {
            if (string.IsNullOrEmpty(Text)) return;
            IDictionary<string, object>? itemAdditionalData = null;
            if (item is IAdditionalDataHolder holder)
            {
                holder.AdditionalData ??= new Dictionary<string, object>();
                itemAdditionalData = holder.AdditionalData;
            }
            //When targeting maccatalyst, new keyword for hiding an existing member is not being respected, returning only id and odata type
            //the below line fixes the issue
            var fieldDeserializers = (IDictionary<string, Action<IParseNode>>)item.GetType().GetMethod("GetFieldDeserializers").Invoke(item, null);
            var fieldDeserializer = fieldDeserializers["Content"];
            fieldDeserializer.Invoke(new HtmlParseNode(Text)
            {
                OnBeforeAssignFieldValues = OnBeforeAssignFieldValues,
                OnAfterAssignFieldValues = OnAfterAssignFieldValues
            });

        }

        /// <inheritdoc />
        public sbyte? GetSbyteValue() => sbyte.TryParse(Text, out var result) ? result : null;
        /// <inheritdoc />
        public string? GetStringValue() => Text;
        /// <inheritdoc />
        public TimeSpan? GetTimeSpanValue() => string.IsNullOrEmpty(Text) ? null : XmlConvert.ToTimeSpan(Text);
        /// <inheritdoc />
        public Time? GetTimeValue() => DateTime.TryParse(Text, out var result) ? new Time(result) : null;
        /// <inheritdoc />
        IEnumerable<T?> IParseNode.GetCollectionOfEnumValues<T>() => throw new InvalidOperationException(NoStructuredDataMessage);
        /// <inheritdoc />
        T? IParseNode.GetEnumValue<T>() => Enum.TryParse<T>(Text, true, out var result) ? result : null;
    }

}
